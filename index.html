<!-- Container so we can layer an SVG overlay above the image -->
<div id="map-container" style="position: relative; display: inline-block;">
  <!-- 1) Image that references the map -->
  <img id="plan-img" src="images/SK_F.jpg" usemap="#buildings" alt="Byggkart" style="max-width:100%; height:auto;">

  <!-- 2) SVG overlay (drawn from your <area> coords). Pointer-events disabled so image map still works. -->
  <svg id="map-overlay" style="position:absolute; inset:0; width:100%; height:100%; pointer-events:none;">
    <defs>
      <!-- Gradients -->
      <linearGradient id="grad-red" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#ff4d4d;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#990000;stop-opacity:1" />
      </linearGradient>
      <linearGradient id="grad-green" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#66ff66;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#006600;stop-opacity:1" />
      </linearGradient>
      <linearGradient id="grad-orange" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#ffcc66;stop-opacity:1" />
        <stop offset="100%" style="stop-color:#cc6600;stop-opacity:1" />
      </linearGradient>
    </defs>
  </svg>
</div>

<!-- 2) Your existing map (kept as-is) -->
<map name="buildings" id="map-area" class="map-hold" minpris="4500000" maxpris="7500000" minbra="45" maxbra="120" minrom="1" maxrom="4">
						<area shape="rect" coords="1704,19,1873,143" href="E.html" alt="Ta meg til E-bygget" title="Ta meg til E-bygget">
						<area shape="rect" coords="1344,19,1514,143" href="G.html" alt="Ta meg til G-bygget" title="Ta meg til G-bygget">
						
						<area showfilled="true" shape="poly" coords="1623,820,1798,819,1798,811,1769,789,1817,789,1820,968,1612,967,1612,962,1622,962" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=19" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="61" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1342,862,1558,860,1558,851,1529,821,1622,822,1621,961,1613,962,1613,967,1510,962,1548,1015,1373,1017,1341,963" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=20" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="56" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="992,818,1177,817,1190,863,1342,863,1342,962,1145,962,1145,1014,810,1015,809,862,994,862" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=21" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="120" blockedbra="false" rom="4" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="282,814,369,814,347,847,346,860,715,860,729,819,809,819,809,1016,299,1015,317,968,283,968" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=22" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="96" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="85,787,133,787,109,806,108,819,281,820,282,967,45,964,86,915" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=23" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="52" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1624,681,1798,682,1798,673,1767,661,1818,662,1820,790,1769,789,1797,811,1798,823,1624,820" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=24" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="61" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1369,713,1557,714,1557,700,1534,681,1622,680,1623,821,1529,820,1557,847,1558,861,1372,862" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=25" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="56" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1082,681,1175,681,1192,712,1369,712,1372,865,1191,865,1178,817,1082,818" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=26" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="50" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="810,715,993,715,992,681,1082,680,1082,818,992,818,994,845,995,861,810,863" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=27" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="67" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="532,716,714,715,729,681,811,682,810,818,728,819,717,861,532,861" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=28" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="281,682,369,683,350,698,350,715,531,716,532,860,346,860,347,847,370,813,282,813" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=29" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="83,666,122,666,109,672,108,683,280,683,281,820,109,820,109,807,133,786,85,786" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=30" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="0" blockedpris="false" bra="52" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1621,549,1795,548,1795,530,1819,530,1819,663,1766,660,1797,673,1797,683,1625,684" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;00661A&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;00661A&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=31" class="appartment colorGreen tooltipstered showFilled" pris="4500000" maxpris="4500000" blockedpris="false" bra="61" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1374,570,1557,571,1557,557,1531,543,1624,543,1624,682,1534,680,1557,698,1558,714,1375,714" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=32" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4500000" blockedpris="false" bra="56" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1083,543,1173,544,1192,571,1374,570,1373,714,1194,712,1175,681,1082,681" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=33" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4500000" blockedpris="false" bra="50" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="810,570,994,570,993,544,1082,544,1082,682,992,681,994,715,811,715" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;00661A&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;00661A&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=34" class="appartment colorGreen tooltipstered showFilled" pris="4800000" maxpris="4800000" blockedpris="false" bra="67" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="530,571,712,569,728,545,811,545,811,682,729,682,712,716,530,716" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=35" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="282,543,349,542,347,571,530,571,531,716,351,716,350,699,368,683,281,682" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=36" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="86,523,110,523,110,548,281,549,281,682,109,683,109,673,121,666,85,667" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;00661A&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;00661A&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=37" class="appartment colorGreen tooltipstered showFilled" pris="4500000" maxpris="4800000" blockedpris="false" bra="61" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1620,370,1819,371,1819,530,1794,531,1795,550,1621,548" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=38" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="61" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1374,415,1556,415,1562,395,1620,396,1622,542,1530,543,1556,556,1556,571,1374,571" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=39" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="56" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1084,403,1177,404,1193,416,1373,416,1375,570,1194,571,1172,546,1084,544" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=40" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="50" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="815,416,994,415,995,404,1083,404,1083,545,993,543,994,571,810,571" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=41" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="67" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="532,417,709,417,730,404,810,405,810,415,815,415,812,544,727,545,713,570,531,571" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=42" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="282,398,349,399,348,417,531,416,531,571,347,570,349,543,282,543" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=43" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="4800000" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="86,390,108,390,108,404,278,403,281,404,282,550,110,550,111,523,86,523" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;00661A&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;00661A&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=44" class="appartment colorGreen tooltipstered showFilled" pris="4600000" maxpris="4800000" blockedpris="false" bra="61" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1347,239,1620,239,1620,241,1708,239,1708,323,1802,330,1804,366,1818,366,1818,372,1621,371,1621,397,1564,396,1557,415,1375,415,1375,274,1348,272" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;00661A&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;00661A&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=45" class="appartment colorGreen tooltipstered showFilled" pris="7500000" maxpris="7500000" blockedpris="false" bra="85" blockedbra="false" rom="3" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="1084,239,1346,239,1347,271,1375,274,1375,416,1195,415,1175,404,1083,404" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=46" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="7500000" blockedpris="false" bra="50" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="821,239,1083,238,1083,405,996,404,996,416,809,416,808,406,812,406,810,274,820,271" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=47" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="7500000" blockedpris="false" bra="67" blockedbra="false" rom="2" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="560,239,820,239,819,270,810,274,811,405,729,406,712,415,532,416,529,272,560,271" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=48" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="7500000" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="284,240,560,239,560,270,529,272,531,417,349,417,348,398,283,399" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;FF0000&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;FF0000&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=49" class="appartment colorRed tooltipstered showFilled" pris="0" maxpris="7500000" blockedpris="false" bra="45" blockedbra="false" rom="1" blockedrom="false">
                        <area showfilled="true" shape="poly" coords="86,241,283,239,282,403,108,405,109,390,86,391" data-maphilight="{&quot;stroke&quot;: false, &quot;fillColor&quot;: &quot;00661A&quot;, &quot;alwaysOn&quot;: false, &quot;shadow&quot;: true, &quot;shadowColor&quot;: &quot;00661A&quot;, &quot;shadowOpacity&quot;: 0.3}" href="valgt.html?per=50" class="appartment colorGreen tooltipstered showFilled" pris="4800000" maxpris="7500000" blockedpris="false" bra="61" blockedbra="false" rom="2" blockedrom="false"></map>

<!-- 3) Tooltip element (initially hidden) -->
<div id="map-tooltip" role="tooltip" aria-hidden="true"></div>

<style>
  /* Tooltip styling */
  #map-tooltip {
    position: fixed;
    pointer-events: none;
    padding: 8px 10px;
    background: rgba(20,20,20,.9);
    color: #fff;
    font: 13px/1.2 system-ui, sans-serif;
    border-radius: 6px;
    box-shadow: 0 6px 20px rgba(0,0,0,.25);
    transform: translate(12px, 12px);
    z-index: 9999;
    opacity: 0;
    transition: opacity .12s ease;
    white-space: nowrap;
  }

  /* Cursor hint over hotspots */
  area { cursor: pointer; }

  /* Overlay shapes (created from your coords) */
/* Overlay shapes (created from your coords) */
.hover-shape {
  stroke: none;
  transition: opacity .18s ease;
}

/* Fill by status */
.hover-shape.sold      { fill: url(#grad-red); }
.hover-shape.available { fill: url(#grad-green); }
.hover-shape.reserved  { fill: url(#grad-orange); }

/* States */
.hover-shape.idle      { opacity: .22; }  /* default: all grids faint */
.hover-shape.highlight { opacity: .60; }  /* hovered grid */
.hover-shape.dim       { opacity: .08; }  /* non-hovered grids */
</style>

<script>
  (function () {
    const img      = document.getElementById('plan-img');
    const map      = document.getElementById('map-area');
    const overlay  = document.getElementById('map-overlay');
    const tooltip  = document.getElementById('map-tooltip');
    const areas    = map.querySelectorAll('area');

    // Link each <area> to its SVG overlay shape
    const shapeForArea = new WeakMap();

    // Ensure the SVG overlay uses the image's intrinsic coordinate space
    function sizeOverlayOnce() {
      const w = img.naturalWidth;
      const h = img.naturalHeight;
      if (w && h) {
        overlay.setAttribute('viewBox', `0 0 ${w} ${h}`);
        overlay.setAttribute('preserveAspectRatio', 'none');
      }
    }
    if (img.complete) sizeOverlayOnce(); else img.addEventListener('load', sizeOverlayOnce);

    // Build overlay shapes from your <area> coords
    areas.forEach((area) => {
      const coords = (area.getAttribute('coords') || '').split(',').map(Number);
      const shape  = (area.getAttribute('shape') || '').toLowerCase();

      // Determine "status" from your classes:
      // colorGreen = available, colorRed = sold, otherwise reserved (adjust if you add colorOrange)
      const status =
        area.classList.contains('colorGreen') ? 'available' :
        area.classList.contains('colorRed')   ? 'sold'      :
                                                'reserved';

      let el = null;

      if (shape === 'poly') {
        const points = [];
        for (let i = 0; i < coords.length; i += 2) {
          points.push(coords[i] + ',' + coords[i + 1]);
        }
        el = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
        el.setAttribute('points', points.join(' '));
      } else if (shape === 'rect') {
        // rect: coords = x1,y1,x2,y2
        const [x1, y1, x2, y2] = coords;
        el = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
        el.setAttribute('x', Math.min(x1, x2));
        el.setAttribute('y', Math.min(y1, y2));
        el.setAttribute('width',  Math.abs(x2 - x1));
        el.setAttribute('height', Math.abs(y2 - y1));
      }

      if (el) {
        el.setAttribute('class', `hover-shape ${status} idle`);
        overlay.appendChild(el);
        shapeForArea.set(area, el);
      }
    });

    // Accessibility + events
    areas.forEach(area => {
      area.setAttribute('tabindex', '0');

      area.addEventListener('mouseenter', onEnter);
      area.addEventListener('focus', onEnter);

      area.addEventListener('mousemove', onMove);

      area.addEventListener('mouseleave', onLeave);
      area.addEventListener('blur', onLeave);

      area.addEventListener('touchstart', (e) => {
        e.preventDefault();
        onEnter.call(area, e.touches[0]);
      }, { passive: false });
      area.addEventListener('touchmove', (e) => onMove(e.touches[0]));
      area.addEventListener('touchend', onLeave);
    });

    function onEnter(evt) {
    // Tooltip content
    const pris  = this.getAttribute('pris');
    const bra   = this.getAttribute('bra');
    const rom   = this.getAttribute('rom');
    const title = this.getAttribute('title') || this.getAttribute('alt') || '';

    tooltip.innerHTML = `
        ${title ? `<div style="font-weight:600;margin-bottom:4px;">${title}</div>` : ''}
        <div>BRA: <strong>${bra || '–'}</strong> m²</div>
        <div>Rom: <strong>${rom || '–'}</strong></div>
        <div>Pris: <strong>${formatNOK(pris)}</strong></div>
    `;
    tooltip.style.opacity = '1';
    tooltip.setAttribute('aria-hidden', 'false');
    if (evt && evt.pageX) positionTooltip(evt.pageX, evt.pageY);

    // Overlay: highlight hovered, dim others
    const hoveredShape = shapeForArea.get(this);
    if (!hoveredShape) return;

    // get all shapes
    const shapes = overlay.querySelectorAll('.hover-shape');
    shapes.forEach(s => {
        s.classList.remove('idle', 'highlight', 'dim');
        if (s === hoveredShape) {
        s.classList.add('highlight');
        } else {
        s.classList.add('dim');
        }
    });
    }

    function onMove(evt) {
      if (!evt) return;
      positionTooltip(evt.pageX, evt.pageY);
    }

    function onLeave() {
    tooltip.style.opacity = '0';
    tooltip.setAttribute('aria-hidden', 'true');

    // Overlay: restore idle to all
    const shapes = overlay.querySelectorAll('.hover-shape');
    shapes.forEach(s => {
        s.classList.remove('highlight', 'dim');
        s.classList.add('idle');
    });
    }

    function positionTooltip(x, y) {
      const padding = 12;
      const { innerWidth:w, innerHeight:h } = window;
      // Use getBoundingClientRect to keep tooltip inside viewport
      tooltip.style.left = Math.min(x + 12, w - tooltip.offsetWidth  - padding) + 'px';
      tooltip.style.top  = Math.min(y + 12, h - tooltip.offsetHeight - padding) + 'px';
    }

    function formatNOK(value) {
      if (!value || Number(value) <= 0) return 'Ikke tilgjengelig';
      try {
        return new Intl.NumberFormat('nb-NO', { style: 'currency', currency: 'NOK', maximumFractionDigits: 0 }).format(value);
      } catch {
        return value;
      }
    }
  })();
</script>
